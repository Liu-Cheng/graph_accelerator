cscope 15 $HOME/gitrepo/graph_accelerator/bfs               0000021810
	@bfs.cpp

1 
	~<ùime
>

2 
	~"g¿ph.h
"

4 
	$maš
(
¬gc
, ** 
¬gv
){

6 
»³©_num
 = 10;

7 
¡d
::
veùÜ
<> 
¡¬t_šdiûs
{1, 2, 3, 4, 5, 6, 7, 8, 9, 10};

8 
¡d
::
¡ršg
 
âame
 = 
¬gv
[1];

9 
¡d
::
¡ršg
 
bfs_ty³
 = 
¬gv
[2];

10 
¡d
::
¡ršg
 
g¿ph_ty³
 = 
¬gv
[3];

12 
G¿ph
* 
g±r
;

13 if(
g¿ph_ty³
 == "dblp"){

14 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/dblp.ungraph.txt");

16 if(
g¿ph_ty³
 == "youtube"){

17 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/youtube.ungraph.txt");

19 if(
g¿ph_ty³
 == "lj"){

20 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/lj.ungraph.txt");

22 if(
g¿ph_ty³
 == "pokec"){

23 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/pokec-relationships.txt");

25 if(
g¿ph_ty³
 == "wiki-talk"){

26 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/wiki-Talk.txt");

28 if(
g¿ph_ty³
 == "lj1"){

29 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/LiveJournal1.txt");

31 if(
g¿ph_ty³
 == "orkut"){

32 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/orkut.ungraph.txt");

34 if(
g¿ph_ty³
 == "rmat"){

35 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/rmat-2m-256m.txt");

37 if(
g¿ph_ty³
 == "twitter"){

38 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/twitter_rv.txt");

40 if(
g¿ph_ty³
 == "friendster"){

41 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/friendster.ungraph.txt");

43 if(
g¿ph_ty³
 == "example"){

44 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/rmat-1k-10k.txt");

47 
g±r
 = 
Ãw
 
	`G¿ph
("./data/mydata.txt");

50 
g±r
->
	`g‘RªdomS¹Indiûs
(
¡¬t_šdiûs
);

51 
g±r
->
	`g‘St
();

52 
CSR
* 
c¤_±r
 = 
Ãw
 
	`CSR
(*
g±r
);

53 
c¤_±r
->
	`deg»eAÇlysis
();

54 
c¤_±r
->
	`£tBfsP¬am
(0.2, 5000, 1024, 256, 1024);

57 
¡d
::
of¡»am
 
	`fhªdË
(
âame
.
	`c_¡r
());

58 if(!
fhªdË
.
	`is_İ’
()){

59 
HERE
;

60 
¡d
::
cout
 << "FaedØİ’ " << 
âame
 << std::
’dl
;

61 
	`ex™
(
EXIT_FAILURE
);

64 
tÙ®_time
 = 0;

65 autØ
idx
 : 
¡¬t_šdiûs
){

66 
¡d
::
şock_t
 
begš
 = 
	`şock
();

67 if(
bfs_ty³
 == "basic"){

68 
c¤_±r
->
	`basicBfs
(
idx
, 
fhªdË
);

70 if(
bfs_ty³
 == "td"){

71 
c¤_±r
->
	`tdBfs
(
idx
, 
fhªdË
);

73 if(
bfs_ty³
 == "bu"){

74 
c¤_±r
->
	`buBfs
(
idx
, 
fhªdË
);

76 if(
bfs_ty³
 == "hybrid"){

77 
c¤_±r
->
	`hybridBfs
(
idx
, 
fhªdË
);

79 if(
bfs_ty³
 == "cache"){

80 
c¤_±r
->
	`ÿcheHybridBfs
(
idx
, 
fhªdË
);

83 
HERE
;

84 
¡d
::
cout
 << "UnknowÀbf ty³." << std::
’dl
;

85 
	`ex™
(
EXIT_FAILURE
);

88 
¡d
::
şock_t
 
’d
 = 
	`şock
();

89 
–­£d_£c
 = (
’d
 - 
begš
)/
CLOCKS_PER_SEC
;

90 
tÙ®_time
 +ğ
–­£d_£c
;

92 
fhªdË
.
	`şo£
();

94 
avg_time
 = 
tÙ®_time
 / 
»³©_num
;

95 
¡d
::
cout
 << "BFS„umime: " << 
avg_time
 << " secÚds." << std::
’dl
;

99 
	}
}

	@graph.cpp

1 
	~"g¿ph.h
"

3 
	gG¿ph
::
lßdFe
(

4 cÚ¡ 
¡d
::
¡ršg
& 
âame
,

5 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a


8 
¡d
::
if¡»am
 
fhªdË
(
âame
.
c_¡r
());

9 if(!
	gfhªdË
.
is_İ’
()){

10 
	gHERE
;

11 
	g¡d
::
cout
 << "FaedØİ’ " << 
âame
 << 
¡d
::
’dl
;

12 
ex™
(
EXIT_FAILURE
);

15 
	g¡d
::
¡ršg
 
lše
;

16 
	g¡d
::
g‘lše
(
fhªdË
, 
lše
)){

17 
	g¡d
::
i¡ršg¡»am
 
iss
(
lše
);

18 
	gd©a
.
push_back
(

19 
¡d
::
veùÜ
<>(¡d::
i¡»am_™”©Ü
<>(
iss
),

20 
¡d
::
i¡»am_™”©Ü
<>())

23 
	gfhªdË
.
şo£
();

28 
	gG¿ph
::
	$g‘St
(){

29 
z”o_outgošg_v”‹x_num
 = 0;

30 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

31 if((*
™
)->
out_vids
.
	`em±y
()){

32 
z”o_outgošg_v”‹x_num
++;

35 
¡d
::
cout
 << "Z”Øoutgošg v”‹x…”ûÁagi " << 
z”o_outgošg_v”‹x_num
 * 1.0 / 
v”‹x_num
 << std::
’dl
;

36 
	}
}

38 
	gG¿ph
::
g‘MaxIdx
(cÚ¡ 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a
){

39 
max_idx
 = 
d©a
[0][0];

40 autØ
	g™1
 = 
d©a
.
begš
(); it1 !ğd©a.
’d
(); it1++){

41 autØ
	g™2
 = 
™1
->
begš
(); it2 !ğ™1->
’d
(); it2++){

42 if(
	gmax_idx
 <ğ(*
™2
)){

43 
max_idx
 = *
™2
;

47  
	gmax_idx
;

50 
	gG¿ph
::
g‘MšIdx
(cÚ¡ 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a
){

51 
mš_idx
 = 
d©a
[0][0];

52 autØ
	g™1
 = 
d©a
.
begš
(); it1 !ğd©a.
’d
(); it1++){

53 autØ
	g™2
 = 
™1
->
begš
(); it2 !ğ™1->
’d
(); it2++){

54 if(
	gmš_idx
 >ğ(*
™2
)){

55 
mš_idx
 = *
™2
;

59  
	gmš_idx
;

62 
	gG¿ph
::
g‘RªdomS¹Indiûs
(
¡d
::
veùÜ
<> &
¡¬t_šdiûs
){

63 
size_t
 
num
 = 
¡¬t_šdiûs
.
size
();

64 
	g¡¬t_šdiûs
.
ş—r
();

65 
size_t
 
	gn
 = 0;

66 
	gn
 < 
	gnum
){

67 
	gmax_idx
 = 
v”‹x_num
 - 1;

68 
	gidx
 = 
¿nd
()%
max_idx
;

69 if(
	gv”tiûs
[
idx
]->
	gout_vids
.
em±y
(è|| 
	g¡d
::
fšd
(
¡¬t_šdiûs
.
begš
(), s¹_šdiûs.
’d
(), idx) != start_indices.end()){

72 
	g¡¬t_šdiûs
.
push_back
(
idx
);

73 
	gn
++;

77 
	gG¿ph
::
	$G¿ph
(cÚ¡ 
¡d
::
¡ršg
& 
âame
){

80 autØ
found
 = 
âame
.
	`fšd
("ungraph", 0);

81 if(
found
 !ğ
¡d
::
¡ršg
::
Åos
)

82 
isUg¿ph
 = 
Œue
;

84 
isUg¿ph
 = 
çl£
;

86 
¡d
::
veùÜ
<¡d::veùÜ<>> 
d©a
;

87 
	`lßdFe
(
âame
, 
d©a
);

88 
v”‹x_num
 = 
	`g‘MaxIdx
(
d©a
) + 1;

89 
edge_num
 = ()
d©a
.
	`size
();

90 
¡d
::
cout
 << "v”‹x‚um: " << 
v”‹x_num
 << std::
’dl
;

91 
¡d
::
cout
 << "edgnum: " << 
edge_num
 << std::
’dl
;

93 
i
 = 0; i < 
v”‹x_num
; i++){

94 
V”‹x
* 
v
 = 
Ãw
 
	`V”‹x
(
i
);

95 
v”tiûs
.
	`push_back
(
v
);

98 autØ
™
 = 
d©a
.
	`begš
(); iˆ!ğd©a.
	`’d
(); it++){

99 
¤c_idx
 = (*
™
)[0];

100 
d¡_idx
 = (*
™
)[1];

101 
v”tiûs
[
¤c_idx
]->
out_vids
.
	`push_back
(
d¡_idx
);

102 
v”tiûs
[
d¡_idx
]->
š_vids
.
	`push_back
(
¤c_idx
);

103 if(
isUg¿ph
 && 
¤c_idx
 !ğ
d¡_idx
){

104 
v”tiûs
[
d¡_idx
]->
out_vids
.
	`push_back
(
¤c_idx
);

105 
v”tiûs
[
¤c_idx
]->
š_vids
.
	`push_back
(
d¡_idx
);

109 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

110 (*
™
)->
š_deg
 = ()(*™)->
š_vids
.
	`size
();

111 (*
™
)->
out_deg
 = ()(*™)->
out_vids
.
	`size
();

113 
	}
}

115 
	gCSR
::
	$£tBfsP¬am
(
_®pha
, 
_b‘a
, 
_hub_v”‹x_th»shŞd
, 
_ÿche_th»shŞd
, 
_buck‘_num
){

116 
®pha
 = 
_®pha
;

117 
b‘a
 = 
_b‘a
;

118 
hub_v”‹x_th»shŞd
 = 
_hub_v”‹x_th»shŞd
;

119 
ÿche_th»shŞd
 = 
_ÿche_th»shŞd
;

120 
buck‘_num
 = 
_buck‘_num
;

121 
	}
}

123 
	gCSR
::
	$CSR
(cÚ¡ 
G¿ph
 &
g
è: 
	`v_num
(g.
v”‹x_num
), 
	$e_num
(
g
.
edge_num
){

126 
®pha
 = 0.2;

127 
b‘a
 = 0.1;

128 
hub_v”‹x_th»shŞd
 = 1024;

129 
ÿche_th»shŞd
 = 256;

130 
buck‘_num
 = 1024;

133 
weight
.
	`»size
(
e_num
);

134 autØ&
w
 : 
weight
){

135 
w
 = (
	`¿nd
()%100)/10.0;

138 
½ao
.
	`»size
(
v_num
+1);

139 
½ai
.
	`»size
(
v_num
+1);

140 
½ao
[0] = 0;

141 
½ai
[0] = 0;

142 
i
 = 0; i < 
v_num
; i++){

143 
½ao
[
i
+1] =„·o[i] + 
g
.
v”tiûs
[i]->
out_deg
;

144 
½ai
[
i
+1] =„·i[i] + 
g
.
v”tiûs
[i]->
š_deg
;

147 
i
 = 0; i < 
v_num
; i++){

148 autØ
id
 : 
g
.
v”tiûs
[
i
]->
out_vids
){

149 
cŸo
.
	`push_back
(
id
);

151 autØ
id
 : 
g
.
v”tiûs
[
i
]->
š_vids
){

152 
cŸi
.
	`push_back
(
id
);

156 
	}
}

162 
boŞ
 
	gCSR
::
	$basicBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
){

164 
»ad_by‹s
 = 0;

165 
wr™e_by‹s
 = 0;

167 
Ëv–
 = 0;

168 
¡d
::
veùÜ
<> 
d•th
;

169 
d•th
.
	`»size
(
v_num
);

170 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

172 
d•th
[
¡¬t_idx
] = 0;

173 
¡d
::
veùÜ
<> 
äÚt›r
;

174 
äÚt›r
.
	`push_back
(
¡¬t_idx
);

175 
¡d
::
veùÜ
<
size_t
> 
äÚt›r_di¡ributiÚ
;

177 !
äÚt›r
.
	`em±y
()){

178 
¡d
::
veùÜ
<> 
Ãxt_äÚt›r
;

181 autØ
vidx
 : 
äÚt›r
){

182 
»ad_by‹s
 += 4;

184 
»ad_by‹s
 += 4;

185 
cidx
 = 
½ao
[
vidx
]; cidx <„pao[vidx+1]; cidx++){

187 
»ad_by‹s
 += 4;

188 
out_ngb
 = 
cŸo
[
cidx
];

190 
»ad_by‹s
 += 1;

191 if(
d•th
[
out_ngb
] == -1){

193 
wr™e_by‹s
 += 1;

194 
d•th
[
out_ngb
] = 
Ëv–
 + 1;

197 
wr™e_by‹s
 += 4;

198 
Ãxt_äÚt›r
.
	`push_back
(
out_ngb
);

204 
äÚt›r_di¡ributiÚ
.
	`push_back
(
äÚt›r
.
	`size
());

205 
äÚt›r
 = 
Ãxt_äÚt›r
;

206 
Ëv–
++;

209 autØ
d
 : 
d•th
){

210 
fhªdË
 << 
d
 << " ";

212 
fhªdË
 << 
¡d
::
’dl
;

214 
¡d
::
cout
 << "»ad/wr™by‹ " << 
»ad_by‹s
 << " " << 
wr™e_by‹s
 << std::
’dl
;

216 
¡d
::
cout
 << "äÚt›¸di¡ributiÚ: " << std::
’dl
;

217 autØ
num
 : 
äÚt›r_di¡ributiÚ
){

218 
¡d
::
cout
 << 
num
 << " ";

220 
¡d
::
cout
 << std::
’dl
;

222  
Œue
;

223 
	}
}

226 
boŞ
 
	gCSR
::
	$tdBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
){

228 
»ad_by‹s
 = 0;

229 
wr™e_by‹s
 = 0;

231 
Ëv–
 = 0;

232 
¡d
::
veùÜ
<> 
d•th
;

233 
d•th
.
	`»size
(
v_num
);

234 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

235 
d•th
[
¡¬t_idx
] = 0;

237 
¡d
::
veùÜ
<> 
äÚt›r
;

238 
¡d
::
veùÜ
<
size_t
> 
äÚt›r_di¡ributiÚ
;

239 
boŞ
 
’d_of_bfs
;

242 
äÚt›r
.
	`ş—r
();

245 
idx
 = 0; idx < 
v_num
; idx++){

246 
»ad_by‹s
 += 1;

247 if(
d•th
[
idx
] =ğ
Ëv–
){

248 
wr™e_by‹s
 += 4;

249 
äÚt›r
.
	`push_back
(
idx
);

255 autØ
Œav”£
 = [&
d•th
, 
Ëv–
, &
»ad_by‹s
, &
wr™e_by‹s
, 
this
](cÚ¡ 
¡d
::
veùÜ
<> &
äÚt›r
){

256 autØ
vidx
 : 
äÚt›r
){

257 
»ad_by‹s
 += 4;

258 
»ad_by‹s
 += 4;

259 
cidx
 = 
½ao
[
vidx
]; cidx <„pao[vidx+1]; cidx++){

261 
»ad_by‹s
 += 4;

262 
out_ngb
 = 
cŸo
[
cidx
];

264 
»ad_by‹s
 += 1;

265 if(
d•th
[
out_ngb
] == -1){

267 
wr™e_by‹s
 += 1;

268 
d•th
[
out_ngb
] = 
Ëv–
 + 1;

273 
	`Œav”£
(
äÚt›r
);

274 
äÚt›r_di¡ributiÚ
.
	`push_back
(
äÚt›r
.
	`size
());

277 
Ëv–
++;

278 
’d_of_bfs
 = 
äÚt›r
.
	`em±y
();

280 } !
’d_of_bfs
);

283 autØ
d
 : 
d•th
){

284 
fhªdË
 << 
d
 << " ";

286 
fhªdË
 << 
¡d
::
’dl
;

288 
¡d
::
cout
 << "»ad/wr™by‹s: " << 
»ad_by‹s
 << " " << 
wr™e_by‹s
 << std::
’dl
;

289 
¡d
::
cout
 << "äÚt›¸di¡ributiÚ: " << std::
’dl
;

290 autØ
num
 : 
äÚt›r_di¡ributiÚ
){

291 
¡d
::
cout
 << 
num
 << " ";

293 
¡d
::
cout
 << std::
’dl
;

296  
Œue
;

297 
	}
}

300 
boŞ
 
	gCSR
::
	$buBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
){

302 
»ad_by‹s
 = 0;

303 
wr™e_by‹s
 = 0;

305 
Ëv–
 = 0;

306 
¡d
::
veùÜ
<> 
d•th
;

307 
d•th
.
	`»size
(
v_num
);

308 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

309 
d•th
[
¡¬t_idx
] = 0;

311 
¡d
::
veùÜ
<> 
äÚt›r
;

312 
¡d
::
veùÜ
<
size_t
> 
äÚt›r_di¡ributiÚ
;

314 
vis™ed_ngb_num
;

315 
boŞ
 
’d_of_bfs
;

318 
idx
 = 0; idx < 
v_num
; idx++){

319 
»ad_by‹s
 += 1;

320 if(
d•th
[
idx
] == -1){

321 
wr™e_by‹s
 += 4;

322 
äÚt›r
.
	`push_back
(
idx
);

329 
vis™ed_ngb_num
 = 0;

330 autØ
Œav”£
 = [&
d•th
, &
vis™ed_ngb_num
, &
»ad_by‹s
, &
wr™e_by‹s
, 
Ëv–
, 
this
](cÚ¡ 
¡d
::
veùÜ
<> &
äÚt›r
){

331 autØ
vidx
 : 
äÚt›r
){

332 
»ad_by‹s
 += 4;

333 
»ad_by‹s
 += 4;

334 
cidx
 = 
½ai
[
vidx
]; cidx <„pai[vidx+1]; cidx++){

336 
»ad_by‹s
 += 4;

337 
š_ngb
 = 
cŸi
[
cidx
];

339 
»ad_by‹s
 += 1;

340 if(
d•th
[
š_ngb
] =ğ
Ëv–
){

342 
wr™e_by‹s
 += 1;

343 
d•th
[
vidx
] = 
Ëv–
 + 1;

344 
vis™ed_ngb_num
++;

350 
	`Œav”£
(
äÚt›r
);

351 
äÚt›r_di¡ributiÚ
.
	`push_back
(
äÚt›r
.
	`size
());

354 
Ëv–
++;

355 
’d_of_bfs
 = 
äÚt›r
.
	`em±y
(è|| (
vis™ed_ngb_num
 == 0);

356 
äÚt›r
.
	`ş—r
();

358 } !
’d_of_bfs
);

360 autØ
d
 : 
d•th
){

361 
fhªdË
 << 
d
 << " ";

363 
fhªdË
 << 
¡d
::
’dl
;

365 
¡d
::
cout
 << "»ad/wr™by‹s: " << 
»ad_by‹s
 << " " << 
wr™e_by‹s
 << std::
’dl
;

366 
¡d
::
cout
 << "äÚt›¸di¡ributiÚ: " << std::
’dl
;

367 autØ
num
 : 
äÚt›r_di¡ributiÚ
){

368 
¡d
::
cout
 << 
num
 << " ";

370 
¡d
::
cout
 << std::
’dl
;

373  
Œue
;

375 
	}
}

477 
boŞ
 
	gCSR
::
	$hybridBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
){

478 
»ad_by‹s
 = 0;

479 
wr™e_by‹s
 = 0;

481 
Ëv–
 = 0;

482 
¡d
::
veùÜ
<> 
d•th
;

483 
d•th
.
	`»size
(
v_num
);

484 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

485 
d•th
[
¡¬t_idx
] = 0;

487 
¡d
::
veùÜ
<> 
äÚt›r
;

488 
¡d
::
veùÜ
<
size_t
> 
äÚt›r_di¡ributiÚ
;

489 
¡d
::
veùÜ
<> 
äÚt›r_hub_v”‹x
;

490 
¡d
::
veùÜ
<
boŞ
> 
bfs_ty³
;

491 
tÙ®_hub_v”‹x_num
 = 
	`g‘HubV”‹xNum
();

492 
vis™ed_ngb_num
 = 0;

493 
boŞ
 
tİ_down
 = 
Œue
;

494 
boŞ
 
’d_of_bfs
;

498 
äÚt›r
.
	`ş—r
();

499 
bfs_ty³
.
	`push_back
(
tİ_down
);

502 
äÚt›r_hub_v”‹x_num
 = 0;

503 if(
tİ_down
){

504 
idx
 = 0; idx < 
v_num
; idx++){

505 
»ad_by‹s
 += 1;

506 if(
d•th
[
idx
] =ğ
Ëv–
){

507 
wr™e_by‹s
 += 4;

508 
äÚt›r
.
	`push_back
(
idx
);

514 
idx
 = 0; idx < 
v_num
; idx++){

515 
»ad_by‹s
 += 1;

516 if(
d•th
[
idx
] == -1){

517 
wr™e_by‹s
 += 4;

518 
äÚt›r
.
	`push_back
(
idx
);

524 if(
tİ_down
){

526 autØ
Œav”£
 = [&
äÚt›r_hub_v”‹x_num
, &
d•th
, 
Ëv–
, &
»ad_by‹s
, &
wr™e_by‹s
, 
this
](cÚ¡ 
¡d
::
veùÜ
<> &
äÚt›r
){

527 autØ
vidx
 : 
äÚt›r
){

528 
»ad_by‹s
 += 4;

530 
»ad_by‹s
 += 4;

531 
deg»e
 = 
½ao
[
vidx
+1] -„pao[vidx];

533 if(
deg»e
 >ğ
hub_v”‹x_th»shŞd
){

534 
äÚt›r_hub_v”‹x_num
++;

537 
cidx
 = 
½ao
[
vidx
]; cidx <„pao[vidx+1]; cidx++){

539 
»ad_by‹s
 += 4;

540 
out_ngb
 = 
cŸo
[
cidx
];

542 
»ad_by‹s
 += 1;

543 if(
d•th
[
out_ngb
] == -1){

545 
wr™e_by‹s
 += 1;

546 
d•th
[
out_ngb
] = 
Ëv–
 + 1;

551 
	`Œav”£
(
äÚt›r
);

557 
vis™ed_ngb_num
 = 0;

558 autØ
Œav”£
 = [&
äÚt›r_hub_v”‹x_num
, &
d•th
, &
vis™ed_ngb_num
, &
»ad_by‹s
, &
wr™e_by‹s
, 
Ëv–
, 
this
](cÚ¡ 
¡d
::
veùÜ
<> &
äÚt›r
){

559 autØ
vidx
 : 
äÚt›r
){

560 
»ad_by‹s
 += 4;

561 
»ad_by‹s
 += 4;

562 
deg»e
 = 
½ai
[
vidx
+1] -„pai[vidx];

564 
cidx
 = 
½ai
[
vidx
]; cidx <„pai[vidx+1]; cidx++){

565 
»ad_by‹s
 += 4;

566 
š_ngb
 = 
cŸi
[
cidx
];

568 
»ad_by‹s
 += 1;

569 if(
d•th
[
š_ngb
] =ğ
Ëv–
){

571 if(
deg»e
 >ğ
hub_v”‹x_th»shŞd
){

572 
äÚt›r_hub_v”‹x_num
++;

575 
wr™e_by‹s
 += 1;

576 
d•th
[
vidx
] = 
Ëv–
 + 1;

577 
vis™ed_ngb_num
++;

584 
	`Œav”£
(
äÚt›r
);

588 
äÚt›r_di¡ributiÚ
.
	`push_back
(
äÚt›r
.
	`size
());

589 
äÚt›r_hub_v”‹x
.
	`push_back
(
äÚt›r_hub_v”‹x_num
);

592 
Ëv–
++;

593 
’d_of_bfs
 = 
äÚt›r
.
	`em±y
(è|| (
tİ_down
 =ğ
çl£
 && 
vis™ed_ngb_num
 == 0);

594 
hub_³rûÁage
 = 
äÚt›r_hub_v”‹x_num
 * 1.0 / 
tÙ®_hub_v”‹x_num
;

595 if(
tİ_down
 && 
hub_³rûÁage
 >ğ
®pha
){

596 
tİ_down
 = 
çl£
;

598 if(
tİ_down
 =ğ
çl£
 && 
vis™ed_ngb_num
 <ğ
b‘a
){

599 
tİ_down
 = 
Œue
;

602 } !
’d_of_bfs
);

605 autØ
d
 : 
d•th
){

606 
fhªdË
 << 
d
 << " ";

608 
fhªdË
 << 
¡d
::
’dl
;

610 
¡d
::
cout
 << "»ad/wr™by‹s: " << 
»ad_by‹s
 << " " << 
wr™e_by‹s
 << std::
’dl
;

612 
¡d
::
cout
 << "bf ty³: " << std::
’dl
;

613 autØ
s
 : 
bfs_ty³
){

614 
¡d
::
cout
 << 
s
 << " ";

616 
¡d
::
cout
 << std::
’dl
;

618 
¡d
::
cout
 << "äÚt›¸di¡ributiÚ: " << std::
’dl
;

619 autØ
num
 : 
äÚt›r_di¡ributiÚ
){

620 
¡d
::
cout
 << 
num
 << " ";

622 
¡d
::
cout
 << std::
’dl
;

624 
¡d
::
cout
 << "tÙ® hub v”‹x‡mouÁ: " << 
tÙ®_hub_v”‹x_num
 << std::
’dl
;

625 
¡d
::
cout
 << "hub v”‹x‡mouÁ: " << std::
’dl
;

626 autØ
num
 : 
äÚt›r_hub_v”‹x
){

627 
¡d
::
cout
 << 
num
 << " ";

629 
¡d
::
cout
 << std::
’dl
;

632  
Œue
;

633 
	}
}

637 
boŞ
 
	gCSR
::
	$ÿcheHybridBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
){

638 
»ad_by‹s
 = 0;

639 
wr™e_by‹s
 = 0;

641 
Ëv–
 = 0;

642 
¡d
::
veùÜ
<> 
d•th
;

643 
d•th
.
	`»size
(
v_num
);

644 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

645 
d•th
[
¡¬t_idx
] = 0;

647 
¡d
::
veùÜ
<> 
äÚt›r
;

648 
¡d
::
veùÜ
<
size_t
> 
äÚt›r_di¡ributiÚ
;

649 
tÙ®_hub_v”‹x_num
 = 
	`g‘HubV”‹xNum
();

650 
vis™ed_ngb_num
 = 0;

651 
boŞ
 
tİ_down
 = 
Œue
;

652 
boŞ
 
’d_of_bfs
;

654 
¡d
::
veùÜ
<> 
pšg_bufãr
;

655 
¡d
::
veùÜ
<> 
pÚg_bufãr
;

659 
äÚt›r
.
	`ş—r
();

662 
äÚt›r_hub_v”‹x_num
 = 0;

663 if(
tİ_down
){

664 
idx
 = 0; idx < 
v_num
; idx++){

665 
»ad_by‹s
 += 1;

666 if(
d•th
[
idx
] =ğ
Ëv–
){

667 
wr™e_by‹s
 += 4;

668 
äÚt›r
.
	`push_back
(
idx
);

673 
idx
 = 0; idx < 
v_num
; idx++){

674 
»ad_by‹s
 += 1;

675 if(
d•th
[
idx
] == -1){

676 
wr™e_by‹s
 += 4;

677 
äÚt›r
.
	`push_back
(
idx
);

683 if(
tİ_down
){

685 autØ
Œav”£
 = [&
pšg_bufãr
, &
äÚt›r_hub_v”‹x_num
, &
d•th
, 
Ëv–
, &
»ad_by‹s
, &
wr™e_by‹s
, 
this
](cÚ¡ 
¡d
::
veùÜ
<> &
äÚt›r
){

686 autØ
vidx
 : 
äÚt›r
){

687 
»ad_by‹s
 += 4;

688 
»ad_by‹s
 += 4;

689 
deg»e
 = 
½ao
[
vidx
+1] -„pao[vidx];

691 if(
deg»e
 >ğ
hub_v”‹x_th»shŞd
){

692 
äÚt›r_hub_v”‹x_num
++;

694 if(
deg»e
 >ğ
ÿche_th»shŞd
){

695 
pšg_bufãr
.
	`push_back
(
vidx
);

698 
cidx
 = 
½ao
[
vidx
]; cidx <„pao[vidx+1]; cidx++){

700 
»ad_by‹s
 += 4;

701 
out_ngb
 = 
cŸo
[
cidx
];

703 if(
	`isInBufãr
(
pšg_bufãr
, 
out_ngb
)){

706 if(
d•th
[
out_ngb
] == -1){

707 
»ad_by‹s
 += 1;

708 
wr™e_by‹s
 += 1;

709 
d•th
[
out_ngb
] = 
Ëv–
 + 1;

712 
»ad_by‹s
 += 1;

717 
	`Œav”£
(
äÚt›r
);

723 
vis™ed_ngb_num
 = 0;

724 autØ
Œav”£
 = [&
pšg_bufãr
, &
pÚg_bufãr
, &
äÚt›r_hub_v”‹x_num
, &
d•th
, &
vis™ed_ngb_num
, &
»ad_by‹s
, &
wr™e_by‹s
, 
Ëv–
, 
this
](cÚ¡ 
¡d
::
veùÜ
<> &
äÚt›r
){

725 autØ
vidx
 : 
äÚt›r
){

726 
»ad_by‹s
 += 4;

727 
»ad_by‹s
 += 4;

728 
deg»e
 = 
½ai
[
vidx
+1] -„pai[vidx];

730 
cidx
 = 
½ai
[
vidx
]; cidx <„pai[vidx+1]; cidx++){

731 
»ad_by‹s
 += 4;

732 
š_ngb
 = 
cŸi
[
cidx
];

734 if(
	`isInBufãr
(
pšg_bufãr
, 
š_ngb
)){

735 
wr™e_by‹s
 += 1;

736 
d•th
[
vidx
] = 
Ëv–
 + 1;

737 if(
deg»e
 >ğ
hub_v”‹x_th»shŞd
){

738 
äÚt›r_hub_v”‹x_num
++;

740 if(
deg»e
 >ğ
ÿche_th»shŞd
){

741 
pÚg_bufãr
.
	`push_back
(
vidx
);

743 
vis™ed_ngb_num
++;

746 if(
d•th
[
š_ngb
] =ğ
Ëv–
){

747 
»ad_by‹s
 += 1;

748 
wr™e_by‹s
 += 1;

749 
d•th
[
vidx
] = 
Ëv–
 + 1;

750 if(
deg»e
 >ğ
hub_v”‹x_th»shŞd
){

751 
äÚt›r_hub_v”‹x_num
++;

753 if(
deg»e
 >ğ
ÿche_th»shŞd
){

754 
pÚg_bufãr
.
	`push_back
(
vidx
);

756 
vis™ed_ngb_num
++;

760 
»ad_by‹s
 += 1;

766 
	`Œav”£
(
äÚt›r
);

770 
äÚt›r_di¡ributiÚ
.
	`push_back
(
äÚt›r
.
	`size
());

773 
Ëv–
++;

774 
’d_of_bfs
 = 
äÚt›r
.
	`em±y
(è|| (
tİ_down
 =ğ
çl£
 && 
vis™ed_ngb_num
 == 0);

775 
hub_³rûÁage
 = 
äÚt›r_hub_v”‹x_num
 * 1.0 / 
tÙ®_hub_v”‹x_num
;

776 if(
tİ_down
 && 
hub_³rûÁage
 >ğ
®pha
){

777 
tİ_down
 = 
çl£
;

779 if(
tİ_down
 =ğ
çl£
 && 
vis™ed_ngb_num
 <ğ
b‘a
){

780 
tİ_down
 = 
Œue
;

781 
pšg_bufãr
 = 
pÚg_bufãr
;

782 
pÚg_bufãr
.
	`ş—r
();

784 if(
tİ_down
 =ğ
çl£
){

785 
pšg_bufãr
 = 
pÚg_bufãr
;

786 
pÚg_bufãr
.
	`ş—r
();

790 } !
’d_of_bfs
);

793 autØ
d
 : 
d•th
){

794 
fhªdË
 << 
d
 << " ";

796 
fhªdË
 << 
¡d
::
’dl
;

798 
¡d
::
cout
 << "»ad/wr™by‹s: " << 
»ad_by‹s
 << " " << 
wr™e_by‹s
 << std::
’dl
;

799 
¡d
::
cout
 << "äÚt›¸di¡ributiÚ: " << std::
’dl
;

800 autØ
num
 : 
äÚt›r_di¡ributiÚ
){

801 
¡d
::
cout
 << 
num
 << " ";

803 
¡d
::
cout
 << std::
’dl
;

805 
	}
}

808 
	gCSR
::
	$deg»eAÇlysis
(){

810 
¡d
::
m­
<, > 
š_deg»e_di¡ributiÚ
;

811 
¡d
::
m­
<, > 
out_deg»e_di¡ributiÚ
;

812 
idx
 = 0; idx < 
v_num
; idx++){

813 
out_deg»e
 = 
½ao
[
idx
+1] -„pao[idx];

814 
š_deg»e
 = 
½ai
[
idx
+1] -„pai[idx];

816 if(
š_deg»e_di¡ributiÚ
.
	`fšd
(
š_deg»e
è=ğš_deg»e_di¡ributiÚ.
	`’d
()){

817 
š_deg»e_di¡ributiÚ
[
š_deg»e
] = 1;

820 
š_deg»e_di¡ributiÚ
[
š_deg»e
]++;

823 if(
out_deg»e_di¡ributiÚ
.
	`fšd
(
out_deg»e
è=ğout_deg»e_di¡ributiÚ.
	`’d
()){

824 
out_deg»e_di¡ributiÚ
[
out_deg»e
] = 1;

827 
out_deg»e_di¡ributiÚ
[
out_deg»e
]++;

831 
¡d
::
cout
 << "š deg»di¡ributiÚ: " << std::
’dl
;

832 autØ
™
 = 
š_deg»e_di¡ributiÚ
.
	`begš
(); iˆ!ğš_deg»e_di¡ributiÚ.
	`’d
(); it++){

833 
¡d
::
cout
 << 
™
->
fœ¡
 << " " << it->
£cÚd
 << std::
’dl
;

836 
¡d
::
cout
 << "ouˆdeg»di¡ributiÚ: " << std::
’dl
;

837 autØ
™
 = 
out_deg»e_di¡ributiÚ
.
	`begš
(); iˆ!ğout_deg»e_di¡ributiÚ.
	`’d
(); it++){

838 
¡d
::
cout
 << 
™
->
fœ¡
 << " " << it->
£cÚd
 << std::
’dl
;

841 
	}
}

843 
	gCSR
::
	$g‘HubV”‹xNum
(){

844 
max_deg»e
 = 0;

845 
hub_v”‹x_num
 = 0;

846 
idx
 = 0; idx < 
v_num
; idx++){

847 
deg»e
 = 
½ao
[
idx
+1] -„pao[idx];

848 if(
deg»e
 >ğ
hub_v”‹x_th»shŞd
){

849 
hub_v”‹x_num
++;

851 if(
deg»e
 > 
max_deg»e
) max_degree = degree;

855 if(
hub_v”‹x_num
 == 0)

856 
hub_v”‹x_num
 = 1;

858  
hub_v”‹x_num
;

859 
	}
}

861 
boŞ
 
	gCSR
::
isInBufãr
(

862 cÚ¡ 
¡d
::
veùÜ
<> &
bufãr
,

863 cÚ¡ &
idx
)

865 if(
	g¡d
::
fšd
(
bufãr
.
begš
(), bufãr.
’d
(), 
idx
) != buffer.end()){

866  
Œue
;

869  
	gçl£
;

	@graph.h

1 #iâdeà
__GRAPH_H__


2 
	#__GRAPH_H__


	)

4 
	~<veùÜ
>

5 
	~<f¡»am
>

6 
	~<io¡»am
>

7 
	~<™”©Ü
>

8 
	~<c¡dlib
>

9 
	~<s¡»am
>

10 
	~<cm©h
>

11 
	~<m­
>

12 
	~<®gÜ™hm
>

14 
	#HERE
 dØ{
¡d
::
cout
 << "Fe: " << 
__FILE__
 << " Lše: " << 
__LINE__
 << std::
’dl
;} 0)

	)

16 şas 
	cV”‹x
 {

17 
	mpublic
:

18 
idx
;

19 
	mš_deg
;

20 
	mout_deg
;

22 
	m¡d
::
veùÜ
<> 
š_vids
;

23 
	m¡d
::
veùÜ
<> 
out_vids
;

25 
ex¶ic™
 
	$V”‹x
(
_idx
) {

26 
idx
 = 
_idx
;

29 ~
	$V”‹x
(){

31 
	}
}

35 şas 
	cG¿ph
{

36 
	mpublic
:

37 
v”‹x_num
;

38 
	medge_num
;

39 
	m¡d
::
veùÜ
<
V”‹x
*> 
v”tiûs
;

41 
G¿ph
(cÚ¡ 
¡d
::
¡ršg
 &
âame
);

42 ~
G¿ph
();

43 
g‘RªdomS¹Indiûs
(
¡d
::
veùÜ
<> &
¡¬t_šdiûs
);

44 
g‘St
();

46 
	m´iv©e
:

47 
boŞ
 
isUg¿ph
;

48 
g‘MaxIdx
(cÚ¡ 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a
);

49 
g‘MšIdx
(cÚ¡ 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a
);

50 
lßdFe
(

51 cÚ¡ 
¡d
::
¡ršg
& 
âame
,

52 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a


58 şas 
	cCSR
{

59 
	mpublic
:

60 
¡d
::
veùÜ
<> 
weight
;

61 
	m¡d
::
veùÜ
<> 
½ao
;

62 
	m¡d
::
veùÜ
<> 
cŸo
;

63 
	m¡d
::
veùÜ
<> 
½ai
;

64 
	m¡d
::
veùÜ
<> 
cŸi
;

67 
ex¶ic™
 
CSR
(cÚ¡ 
G¿ph
 &
g
);

69 
£tBfsP¬am
(
_®pha
, 
_b‘a
, 
_hub_v”‹x_th»shŞd
, 
_ÿche_th»shŞd
, 
_buck‘_num
);

72 
boŞ
 
ÿcheHybridBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
);

75 
boŞ
 
hybridBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
);

78 
boŞ
 
basicBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
);

81 
boŞ
 
tdBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
);

84 
boŞ
 
buBfs
(cÚ¡ &
¡¬t_idx
, 
¡d
::
of¡»am
 &
fhªdË
);

86 
deg»eAÇlysis
();

87 ~
CSR
();

89 
	m´iv©e
:

90 cÚ¡ 
v_num
;

91 cÚ¡ 
	me_num
;

92 
	m®pha
;

93 
	mb‘a
;

94 
	mhub_v”‹x_th»shŞd
;

95 
	mÿche_th»shŞd
;

96 
	mbuck‘_num
;

98 
boŞ
 
isInBufãr
(

99 cÚ¡ 
¡d
::
veùÜ
<> &
bufãr
,

100 cÚ¡ &
idx
);

101 
g‘HubV”‹xNum
();

	@
1
.
1
/usr/include
3
26
bfs.cpp
graph.cpp
graph.h
