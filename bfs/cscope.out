cscope 15 $HOME/gitrepo/graph_accelerator/bfs               0000023212
	@bfs.cpp

1 
	~<ùime
>

2 
	~"g¿ph.h
"

4 
	$maš
(
¬gc
, ** 
¬gv
){

6 
»³©Num
 = 1;

7 
¡d
::
veùÜ
<> 
¡¬tIndiûs
{1429};

8 
¡d
::
¡ršg
 
âame
 = 
¬gv
[1];

9 
¡d
::
¡ršg
 
bfsTy³
 = 
¬gv
[2];

10 
¡d
::
¡ršg
 
g¿phTy³
 = 
¬gv
[3];

12 
G¿ph
* 
g±r
;

13 if(
g¿phTy³
 == "dblp"){

14 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/dblp.ungraph.txt");

16 if(
g¿phTy³
 == "youtube"){

17 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/youtube.ungraph.txt");

19 if(
g¿phTy³
 == "lj"){

20 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/lj.ungraph.txt");

22 if(
g¿phTy³
 == "pokec"){

23 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/pokec-relationships.txt");

25 if(
g¿phTy³
 == "wiki-talk"){

26 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/wiki-Talk.txt");

28 if(
g¿phTy³
 == "lj1"){

29 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/LiveJournal1.txt");

31 if(
g¿phTy³
 == "orkut"){

32 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/orkut.ungraph.txt");

34 if(
g¿phTy³
 == "rmat"){

35 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/rmat-2m-256m.txt");

37 if(
g¿phTy³
 == "rmat1k10k"){

38 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/rmat1k10k.txt");

40 if(
g¿phTy³
 == "rmat10k100k"){

41 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/rmat10k100k.txt");

43 if(
g¿phTy³
 == "twitter"){

44 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/twitter_rv.txt");

46 if(
g¿phTy³
 == "friendster"){

47 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/friendster.ungraph.txt");

49 if(
g¿phTy³
 == "example"){

50 
g±r
 = 
Ãw
 
	`G¿ph
("/home/liucheng/gitrepo/graph-data/rmat-1k-10k.txt");

53 
g±r
 = 
Ãw
 
	`G¿ph
("./data/mydata.txt");

56 
g±r
->
	`g‘RªdomS¹Indiûs
(
¡¬tIndiûs
);

58 
CSR
* 
c¤PŒ
 = 
Ãw
 
	`CSR
(*
g±r
);

60 if(
g¿phTy³
 == "dblp"){

61 
c¤PŒ
->
	`£tBfsP¬am
(0.2, 5000, 128, 64, 1024);

63 if(
g¿phTy³
 == "youtube"){

64 
c¤PŒ
->
	`£tBfsP¬am
(0.2, 5000, 1024, 256, 1024);

66 if(
g¿phTy³
 == "pokec"){

67 
c¤PŒ
->
	`£tBfsP¬am
(0.2, 5000, 4096, 256, 1024);

69 if(
g¿phTy³
 == "lj"){

70 
c¤PŒ
->
	`£tBfsP¬am
(0.2, 5000, 1024, 256, 1024);

72 if(
g¿phTy³
 == "wiki-talk"){

73 
c¤PŒ
->
	`£tBfsP¬am
(0.2, 5000, 1024, 256, 1024);

77 
¡d
::
of¡»am
 
	`fhªdË
(
âame
.
	`c_¡r
());

78 if(!
fhªdË
.
	`is_İ’
()){

79 
HERE
;

80 
¡d
::
cout
 << "FaedØİ’ " << 
âame
 << std::
’dl
;

81 
	`ex™
(
EXIT_FAILURE
);

84 
tÙ®Time
 = 0;

85 autØ
idx
 : 
¡¬tIndiûs
){

86 
¡d
::
cout
 << "¡¬tIdx = " << 
idx
 << std::
’dl
;

87 
¡d
::
şock_t
 
begš
 = 
	`şock
();

88 if(
bfsTy³
 == "basic"){

89 
c¤PŒ
->
	`basicBfs
(
idx
, 
fhªdË
);

91 if(
bfsTy³
 == "td"){

92 
c¤PŒ
->
	`tdBfs
(
idx
, 
fhªdË
);

94 if(
bfsTy³
 == "bu"){

95 
c¤PŒ
->
	`buBfs
(
idx
, 
fhªdË
);

97 if(
bfsTy³
 == "hybrid"){

98 
c¤PŒ
->
	`hybridBfs
(
idx
, 
fhªdË
);

100 if(
bfsTy³
 == "cache"){

101 
c¤PŒ
->
	`ÿcheHybridBfs
(
idx
, 
fhªdË
);

104 
HERE
;

105 
¡d
::
cout
 << "UnknowÀbf ty³." << std::
’dl
;

106 
	`ex™
(
EXIT_FAILURE
);

109 
¡d
::
şock_t
 
’d
 = 
	`şock
();

110 
–­£dTime
 = (
’d
 - 
begš
)/
CLOCKS_PER_SEC
;

111 
tÙ®Time
 +ğ
–­£dTime
;

113 
fhªdË
.
	`şo£
();

115 
avgTime
 = 
tÙ®Time
 / 
»³©Num
;

116 
¡d
::
cout
 << "BFS„umime: " << 
avgTime
 << " secÚds." << std::
’dl
;

120 
	}
}

	@graph.cpp

1 
	~"g¿ph.h
"

3 
	gGL
::
bur¡Ën
 = 64;

5 
	gG¿ph
::
lßdFe
(

6 cÚ¡ 
¡d
::
¡ršg
& 
âame
,

7 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a


10 
¡d
::
if¡»am
 
fhªdË
(
âame
.
c_¡r
());

11 if(!
	gfhªdË
.
is_İ’
()){

12 
	gHERE
;

13 
	g¡d
::
cout
 << "FaedØİ’ " << 
âame
 << 
¡d
::
’dl
;

14 
ex™
(
EXIT_FAILURE
);

17 
	g¡d
::
¡ršg
 
lše
;

18 
	g¡d
::
g‘lše
(
fhªdË
, 
lše
)){

19 
	g¡d
::
i¡ršg¡»am
 
iss
(
lše
);

20 
	gd©a
.
push_back
(

21 
¡d
::
veùÜ
<>(¡d::
i¡»am_™”©Ü
<>(
iss
),

22 
¡d
::
i¡»am_™”©Ü
<>())

25 
	gfhªdË
.
şo£
();

28 
	gG¿ph
::
	$g‘St
(){

29 
z”oOutV”‹xNum
 = 0;

30 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

31 if((*
™
)->
outVid
.
	`em±y
()){

32 
z”oOutV”‹xNum
++;

35 
¡d
::
cout
 << "Zero outgoing vertex…ercentage is ";

36 
¡d
::
cout
 << 
z”oOutV”‹xNum
 * 1.0 / 
v”‹xNum
 << std::
’dl
;

37 
	}
}

39 
	gG¿ph
::
g‘MaxIdx
(cÚ¡ 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a
){

40 
maxIdx
 = 
d©a
[0][0];

41 autØ
	g™1
 = 
d©a
.
begš
(); it1 !ğd©a.
’d
(); it1++){

42 autØ
	g™2
 = 
™1
->
begš
(); it2 !ğ™1->
’d
(); it2++){

43 if(
	gmaxIdx
 <ğ(*
™2
)){

44 
maxIdx
 = *
™2
;

48  
	gmaxIdx
;

51 
	gG¿ph
::
g‘MšIdx
(cÚ¡ 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a
){

52 
mšIdx
 = 
d©a
[0][0];

53 autØ
	g™1
 = 
d©a
.
begš
(); it1 !ğd©a.
’d
(); it1++){

54 autØ
	g™2
 = 
™1
->
begš
(); it2 !ğ™1->
’d
(); it2++){

55 if(
	gmšIdx
 >ğ(*
™2
)){

56 
mšIdx
 = *
™2
;

60  
	gmšIdx
;

63 
	gG¿ph
::
g‘RªdomS¹Indiûs
(
¡d
::
veùÜ
<> &
¡¬tIndiûs
){

64 
size_t
 
num
 = 
¡¬tIndiûs
.
size
();

65 
	g¡¬tIndiûs
.
ş—r
();

66 
size_t
 
	gn
 = 0;

67 
	gn
 < 
	gnum
){

68 
	gmaxIdx
 = 
v”‹xNum
 - 1;

69 
	gidx
 = 
¿nd
()%
maxIdx
;

70 if(
	gv”tiûs
[
idx
]->
	goutVid
.
em±y
() ||

71 
	g¡d
::
fšd
(
¡¬tIndiûs
.
begš
(),

72 
¡¬tIndiûs
.
’d
(), 
idx
) != startIndices.end()

76 
	g¡¬tIndiûs
.
push_back
(
idx
);

77 
	gn
++;

81 
	gG¿ph
::
	$G¿ph
(cÚ¡ 
¡d
::
¡ršg
& 
âame
){

84 autØ
found
 = 
âame
.
	`fšd
("ungraph", 0);

85 if(
found
 !ğ
¡d
::
¡ršg
::
Åos
)

86 
isUg¿ph
 = 
Œue
;

88 
isUg¿ph
 = 
çl£
;

90 
¡d
::
veùÜ
<¡d::veùÜ<>> 
d©a
;

91 
	`lßdFe
(
âame
, 
d©a
);

92 
v”‹xNum
 = 
	`g‘MaxIdx
(
d©a
) + 1;

93 
edgeNum
 = ()
d©a
.
	`size
();

94 
¡d
::
cout
 << "v”‹x‚um: " << 
v”‹xNum
 << std::
’dl
;

95 
¡d
::
cout
 << "edgnum: " << 
edgeNum
 << std::
’dl
;

97 
i
 = 0; i < 
v”‹xNum
; i++){

98 
V”‹x
* 
v
 = 
Ãw
 
	`V”‹x
(
i
);

99 
v”tiûs
.
	`push_back
(
v
);

102 autØ
™
 = 
d©a
.
	`begš
(); iˆ!ğd©a.
	`’d
(); it++){

103 
¤cIdx
 = (*
™
)[0];

104 
d¡Idx
 = (*
™
)[1];

105 
v”tiûs
[
¤cIdx
]->
outVid
.
	`push_back
(
d¡Idx
);

106 
v”tiûs
[
d¡Idx
]->
šVid
.
	`push_back
(
¤cIdx
);

107 if(
isUg¿ph
 && 
¤cIdx
 !ğ
d¡Idx
){

108 
v”tiûs
[
d¡Idx
]->
outVid
.
	`push_back
(
¤cIdx
);

109 
v”tiûs
[
¤cIdx
]->
šVid
.
	`push_back
(
d¡Idx
);

113 autØ
™
 = 
v”tiûs
.
	`begš
(); iˆ!ğv”tiûs.
	`’d
(); it++){

114 (*
™
)->
šDeg
 = ()(*™)->
šVid
.
	`size
();

115 (*
™
)->
outDeg
 = ()(*™)->
outVid
.
	`size
();

117 
	}
}

119 
	gCSR
::
	$£tBfsP¬am
(

120 
_®pha
,

121 
_b‘a
,

122 
_hubV”‹xTh»shŞd
,

123 
_ÿcheTh»shŞd
,

124 
_buck‘Num
)

126 
®pha
 = 
_®pha
;

127 
b‘a
 = 
_b‘a
;

128 
hubV”‹xTh»shŞd
 = 
_hubV”‹xTh»shŞd
;

129 
ÿcheTh»shŞd
 = 
_ÿcheTh»shŞd
;

130 
buck‘Num
 = 
_buck‘Num
;

131 
	}
}

133 
	gCSR
::
	$CSR
(cÚ¡ 
G¿ph
 &
g
è: 
	`vNum
(g.
v”‹xNum
), 
	$eNum
(
g
.
edgeNum
){

136 
®pha
 = 0.2;

137 
b‘a
 = 0.1;

138 
hubV”‹xTh»shŞd
 = 1024;

139 
ÿcheTh»shŞd
 = 256;

140 
buck‘Num
 = 1024;

143 
weight
.
	`»size
(
eNum
);

144 autØ&
w
 : 
weight
){

145 
w
 = (
	`¿nd
()%100)/10.0;

148 
½ao
.
	`»size
(
vNum
+1);

149 
½ai
.
	`»size
(
vNum
+1);

150 
½ao
[0] = 0;

151 
½ai
[0] = 0;

152 
i
 = 0; i < 
vNum
; i++){

153 
½ao
[
i
+1] =„·o[i] + 
g
.
v”tiûs
[i]->
outDeg
;

154 
½ai
[
i
+1] =„·i[i] + 
g
.
v”tiûs
[i]->
šDeg
;

157 
i
 = 0; i < 
vNum
; i++){

158 autØ
id
 : 
g
.
v”tiûs
[
i
]->
outVid
){

159 
cŸo
.
	`push_back
(
id
);

161 autØ
id
 : 
g
.
v”tiûs
[
i
]->
šVid
){

162 
cŸi
.
	`push_back
(
id
);

166 
	}
}

168 
boŞ
 
	gCSR
::
	$basicBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
){

170 
»adBy‹s
 = 0;

171 
wr™eBy‹s
 = 0;

172 
»adBur¡s
 = 0;

173 
wr™eBur¡s
 = 0;

175 
Ëv–
 = 0;

176 
¡d
::
veùÜ
<> 
d•th
;

177 
d•th
.
	`»size
(
vNum
);

178 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

180 
d•th
[
¡¬tIdx
] = 0;

181 
¡d
::
veùÜ
<> 
äÚt›r
;

182 
äÚt›r
.
	`push_back
(
¡¬tIdx
);

183 
¡d
::
veùÜ
<
size_t
> 
äÚt›rDi¡
;

185 !
äÚt›r
.
	`em±y
()){

186 
¡d
::
veùÜ
<> 
ÃxtFrÚt›r
;

189 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(()
äÚt›r
.
	`size
(), 4);

192 autØ
vidx
 : 
äÚt›r
){

193 
»adBy‹s
 += 4;

194 
»adBy‹s
 += 4 * 2;

195 
»adBur¡s
++;

196 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
½ao
[
vidx
+1] -„pao[vidx], 4);

197 
cidx
 = 
½ao
[
vidx
]; cidx <„pao[vidx+1]; cidx++){

198 
»adBy‹s
 += 4;

199 
outNgb
 = 
cŸo
[
cidx
];

201 
»adBy‹s
 += 1;

202 
»adBur¡s
 += 1;

203 if(
d•th
[
outNgb
] == -1){

205 
wr™eBy‹s
 += 1;

206 
wr™eBur¡s
 += 1;

207 
d•th
[
outNgb
] = 
Ëv–
 + 1;

210 
wr™eBy‹s
 += 4;

211 
ÃxtFrÚt›r
.
	`push_back
(
outNgb
);

215 
wr™eBur¡s
 +ğ
	`g‘Bur¡Num
(()
ÃxtFrÚt›r
.
	`size
(), 4);

218 
äÚt›rDi¡
.
	`push_back
(
äÚt›r
.
	`size
());

219 
äÚt›r
 = 
ÃxtFrÚt›r
;

220 
Ëv–
++;

223 autØ
d
 : 
d•th
){

224 
fhªdË
 << 
d
 << 
¡d
::
’dl
;

226 
fhªdË
 << 
¡d
::
’dl
;

228 
¡d
::
cout
 << "»ad/wr™by‹ " << 
»adBy‹s
 << " " << 
wr™eBy‹s
 << std::
’dl
;

229 
¡d
::
cout
 << "»ad/wr™bur¡ " << 
»adBur¡s
 << " " << 
wr™eBur¡s
 << std::
’dl
;

231 
fhªdË
 << "äÚt›¸di¡ributiÚ: " << 
¡d
::
’dl
;

232 autØ
num
 : 
äÚt›rDi¡
){

233 
fhªdË
 << 
num
 << " ";

235 
fhªdË
 << 
¡d
::
’dl
;

236 
fhªdË
.
	`şo£
();

238  
Œue
;

239 
	}
}

242 
boŞ
 
	gCSR
::
	$tdBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
){

244 
»adBy‹s
 = 0;

245 
wr™eBy‹s
 = 0;

246 
»adBur¡s
 = 0;

247 
wr™eBur¡s
 = 0;

249 
Ëv–
 = 0;

250 
¡d
::
veùÜ
<> 
d•th
;

251 
d•th
.
	`»size
(
vNum
);

252 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

253 
d•th
[
¡¬tIdx
] = 0;

255 
¡d
::
veùÜ
<> 
äÚt›r
;

256 
¡d
::
veùÜ
<
size_t
> 
äÚt›rDi¡
;

257 
boŞ
 
eofBfs
;

260 
fhªdË
 << "Lev– = " << 
Ëv–
 << 
¡d
::
’dl
;

261 
äÚt›r
.
	`ş—r
();

262 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
vNum
, 1);

263 
idx
 = 0; idx < 
vNum
; idx++){

264 
»adBy‹s
 += 1;

265 if(
d•th
[
idx
] =ğ
Ëv–
){

266 
äÚt›r
.
	`push_back
(
idx
);

267 
fhªdË
 << 
idx
 << " ";

270 
fhªdË
 << 
¡d
::
’dl
 << std::endl;

271 autØ
vidx
 : 
äÚt›r
){

272 
»adBy‹s
 += 4 * 2;

273 
»adBur¡s
 += 1;

274 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
½ao
[
vidx
+1] -„pao[vidx], 4);

275 
cidx
 = 
½ao
[
vidx
]; cidx <„pao[vidx+1]; cidx++){

277 
»adBy‹s
 += 4;

278 
outNgb
 = 
cŸo
[
cidx
];

280 
»adBy‹s
 += 1;

281 
»adBur¡s
 += 1;

282 if(
d•th
[
outNgb
] == -1){

284 
wr™eBy‹s
 += 1;

285 
wr™eBur¡s
 += 1;

286 
d•th
[
outNgb
] = 
Ëv–
 + 1;

290 
äÚt›rDi¡
.
	`push_back
(
äÚt›r
.
	`size
());

293 
Ëv–
++;

294 
eofBfs
 = 
äÚt›r
.
	`em±y
();

296 } !
eofBfs
);

299 
fhªdË
 << "d•th: " << 
¡d
::
’dl
;

300 autØ
d
 : 
d•th
){

301 
fhªdË
 << 
d
 << 
¡d
::
’dl
;

303 
fhªdË
 << 
¡d
::
’dl
;

305 
¡d
::
cout
 << "»ad/wr™by‹s: " << 
»adBy‹s
 << " " << 
wr™eBy‹s
 << std::
’dl
;

306 
¡d
::
cout
 << "»ad/wr™bur¡s: " << 
»adBur¡s
 << " " << 
wr™eBur¡s
 << std::
’dl
;

308 
fhªdË
 << "äÚt›¸di¡ributiÚ: " << 
¡d
::
’dl
;

309 autØ
num
 : 
äÚt›rDi¡
){

310 
fhªdË
 << 
num
 << " ";

312 
fhªdË
 << 
¡d
::
’dl
;

314  
Œue
;

315 
	}
}

318 
boŞ
 
	gCSR
::
	$buBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
){

320 
»adBy‹s
 = 0;

321 
wr™eBy‹s
 = 0;

322 
»adBur¡s
 = 0;

323 
wr™eBur¡s
 = 0;

325 
Ëv–
 = 0;

326 
¡d
::
veùÜ
<> 
d•th
;

327 
d•th
.
	`»size
(
vNum
);

328 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

329 
d•th
[
¡¬tIdx
] = 0;

331 
¡d
::
veùÜ
<> 
äÚt›r
;

332 
¡d
::
veùÜ
<
size_t
> 
äÚt›rDi¡
;

334 
vis™edNgbNum
;

335 
boŞ
 
eofBfs
;

338 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
vNum
, 1);

339 
idx
 = 0; idx < 
vNum
; idx++){

340 
»adBy‹s
 += 1;

341 if(
d•th
[
idx
] == -1){

342 
äÚt›r
.
	`push_back
(
idx
);

349 
vis™edNgbNum
 = 0;

350 autØ
vidx
 : 
äÚt›r
){

351 
»adBy‹s
 += 4 * 2;

352 
»adBur¡s
 += 1;

354 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
½ai
[
vidx
+1] -„pai[vidx], 4);

355 
cidx
 = 
½ai
[
vidx
]; cidx <„pai[vidx+1]; cidx++){

357 
»adBy‹s
 += 4;

358 
šNgb
 = 
cŸi
[
cidx
];

360 
»adBy‹s
 += 1;

361 
»adBur¡s
 += 1;

362 if(
d•th
[
šNgb
] =ğ
Ëv–
){

364 
wr™eBy‹s
 += 1;

365 
d•th
[
vidx
] = 
Ëv–
 + 1;

366 
wr™eBur¡s
 += 1;

367 
vis™edNgbNum
++;

372 
äÚt›rDi¡
.
	`push_back
(
äÚt›r
.
	`size
());

375 
Ëv–
++;

376 
eofBfs
 = 
äÚt›r
.
	`em±y
(è|| (
vis™edNgbNum
 == 0);

377 
äÚt›r
.
	`ş—r
();

379 } !
eofBfs
);

381 autØ
d
 : 
d•th
){

382 
fhªdË
 << 
d
 << 
¡d
::
’dl
;

384 
fhªdË
 << 
¡d
::
’dl
;

386 
¡d
::
cout
 << "»ad/wr™by‹s: " << 
»adBy‹s
 << " " << 
wr™eBy‹s
 << std::
’dl
;

387 
¡d
::
cout
 << "»ad/wr™bur¡s: " << 
»adBur¡s
 << " " << 
wr™eBur¡s
 << std::
’dl
;

389 
fhªdË
 << "äÚt›¸di¡ributiÚ: " << 
¡d
::
’dl
;

390 autØ
num
 : 
äÚt›rDi¡
){

391 
fhªdË
 << 
num
 << " ";

393 
fhªdË
 << 
¡d
::
’dl
;

395  
Œue
;

397 
	}
}

399 
boŞ
 
	gCSR
::
	$hybridBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
){

400 
»adBy‹s
 = 0;

401 
wr™eBy‹s
 = 0;

402 
»adBur¡s
 = 0;

403 
wr™eBur¡s
 = 0;

405 
Ëv–
 = 0;

406 
¡d
::
veùÜ
<> 
d•th
;

407 
d•th
.
	`»size
(
vNum
);

408 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

409 
d•th
[
¡¬tIdx
] = 0;

411 
¡d
::
veùÜ
<> 
äÚt›r
;

412 
¡d
::
veùÜ
<
size_t
> 
äÚt›rDi¡
;

413 
¡d
::
veùÜ
<> 
äÚt›rHubV”‹x
;

414 
¡d
::
veùÜ
<
boŞ
> 
bfsTy³
;

415 
tÙ®HubV”‹xNum
 = 
	`g‘HubV”‹xNum
();

416 
vis™edNgbNum
 = 0;

417 
boŞ
 
tİDown
 = 
Œue
;

418 
boŞ
 
eofBfs
;

422 
äÚt›r
.
	`ş—r
();

423 
bfsTy³
.
	`push_back
(
tİDown
);

426 
äÚt›rHubV”‹xNum
 = 0;

427 if(
tİDown
){

428 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
vNum
, 1);

429 
idx
 = 0; idx < 
vNum
; idx++){

430 
»adBy‹s
 += 1;

431 if(
d•th
[
idx
] =ğ
Ëv–
){

432 
äÚt›r
.
	`push_back
(
idx
);

437 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
vNum
, 1);

438 
idx
 = 0; idx < 
vNum
; idx++){

439 
»adBy‹s
 += 1;

440 if(
d•th
[
idx
] == -1){

441 
äÚt›r
.
	`push_back
(
idx
);

446 if(
tİDown
){

447 autØ
vidx
 : 
äÚt›r
){

448 
»adBy‹s
 += 4 * 2;

449 
»adBur¡s
 += 1;

450 
deg»e
 = 
½ao
[
vidx
+1] -„pao[vidx];

452 if(
deg»e
 >ğ
hubV”‹xTh»shŞd
){

453 
äÚt›rHubV”‹xNum
++;

456 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
½ao
[
vidx
+1] -„pao[vidx], 4);

457 
cidx
 = 
½ao
[
vidx
]; cidx <„pao[vidx+1]; cidx++){

458 
»adBy‹s
 += 4;

459 
outNgb
 = 
cŸo
[
cidx
];

461 
»adBy‹s
 += 1;

462 
»adBur¡s
 += 1;

463 if(
d•th
[
outNgb
] == -1){

464 
wr™eBy‹s
 += 1;

465 
wr™eBur¡s
 += 1;

466 
d•th
[
outNgb
] = 
Ëv–
 + 1;

475 
vis™edNgbNum
 = 0;

476 autØ
vidx
 : 
äÚt›r
){

477 
»adBy‹s
 += 4 * 2;

478 
»adBur¡s
 += 1;

479 
deg»e
 = 
½ai
[
vidx
+1] -„pai[vidx];

481 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
½ai
[
vidx
+1] -„pai[vidx], 4);

482 
cidx
 = 
½ai
[
vidx
]; cidx <„pai[vidx+1]; cidx++){

483 
»adBy‹s
 += 4;

484 
šNgb
 = 
cŸi
[
cidx
];

486 
»adBy‹s
 += 1;

487 
»adBur¡s
 += 1;

488 if(
d•th
[
šNgb
] =ğ
Ëv–
){

489 if(
deg»e
 >ğ
hubV”‹xTh»shŞd
){

490 
äÚt›rHubV”‹xNum
++;

492 
wr™eBy‹s
 += 1;

493 
wr™eBur¡s
 += 1;

494 
d•th
[
vidx
] = 
Ëv–
 + 1;

495 
vis™edNgbNum
++;

504 
äÚt›rDi¡
.
	`push_back
(
äÚt›r
.
	`size
());

505 
äÚt›rHubV”‹x
.
	`push_back
(
äÚt›rHubV”‹xNum
);

508 
Ëv–
++;

509 
eofBfs
 = 
äÚt›r
.
	`em±y
(è|| (
tİDown
 =ğ
çl£
 && 
vis™edNgbNum
 == 0);

510 
hubP”ûÁage
 = 
äÚt›rHubV”‹xNum
 * 1.0 / 
tÙ®HubV”‹xNum
;

511 if(
tİDown
 && 
hubP”ûÁage
 >ğ
®pha
){

512 
tİDown
 = 
çl£
;

514 if(
tİDown
 =ğ
çl£
 && 
vis™edNgbNum
 <ğ
b‘a
){

515 
tİDown
 = 
Œue
;

518 } !
eofBfs
);

521 autØ
d
 : 
d•th
){

522 
fhªdË
 << 
d
 << " ";

524 
fhªdË
 << 
¡d
::
’dl
;

526 
¡d
::
cout
 << "»ad/wr™by‹s: " << 
»adBy‹s
 << " " << 
wr™eBy‹s
 << std::
’dl
;

527 
¡d
::
cout
 << "»ad/wr™bur¡s: " << 
»adBur¡s
 << " " << 
wr™eBur¡s
 << std::
’dl
;

529 
fhªdË
 << "bf ty³: " << 
¡d
::
’dl
;

530 autØ
s
 : 
bfsTy³
){

531 
fhªdË
 << 
s
 << " ";

533 
fhªdË
 << 
¡d
::
’dl
;

535 
fhªdË
 << "äÚt›¸di¡ributiÚ: " << 
¡d
::
’dl
;

536 autØ
num
 : 
äÚt›rDi¡
){

537 
fhªdË
 << 
num
 << " ";

539 
fhªdË
 << 
¡d
::
’dl
;

541 
¡d
::
cout
 << "tÙ® hub v”‹x‡mouÁ: " << 
tÙ®HubV”‹xNum
 << std::
’dl
;

542 
¡d
::
cout
 << "hub v”‹x‡mouÁ: " << std::
’dl
;

543 autØ
num
 : 
äÚt›rHubV”‹x
){

544 
¡d
::
cout
 << 
num
 << " ";

546 
¡d
::
cout
 << std::
’dl
;

548  
Œue
;

549 
	}
}

553 
boŞ
 
	gCSR
::
	$ÿcheHybridBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
){

554 
»adBy‹s
 = 0;

555 
wr™eBy‹s
 = 0;

556 
»adBur¡s
 = 0;

557 
wr™eBur¡s
 = 0;

559 
Ëv–
 = 0;

560 
¡d
::
veùÜ
<> 
d•th
;

561 
d•th
.
	`»size
(
vNum
);

562 
¡d
::
	`fl
(
d•th
.
	`begš
(), d•th.
	`’d
(), -1);

563 
d•th
[
¡¬tIdx
] = 0;

565 
¡d
::
veùÜ
<> 
äÚt›r
;

566 
¡d
::
veùÜ
<
size_t
> 
äÚt›rDi¡
;

567 
tÙ®HubV”‹xNum
 = 
	`g‘HubV”‹xNum
();

568 
vis™edNgbNum
 = 0;

569 
boŞ
 
tİDown
 = 
Œue
;

570 
boŞ
 
eofBfs
;

572 
¡d
::
veùÜ
<> 
pšgBufãr
;

573 
¡d
::
veùÜ
<> 
pÚgBufãr
;

577 
äÚt›r
.
	`ş—r
();

580 
äÚt›rHubV”‹xNum
 = 0;

581 if(
tİDown
){

582 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
vNum
, 1);

583 
idx
 = 0; idx < 
vNum
; idx++){

584 
»adBy‹s
 += 1;

585 if(
d•th
[
idx
] =ğ
Ëv–
){

586 
äÚt›r
.
	`push_back
(
idx
);

591 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
vNum
, 1);

592 
idx
 = 0; idx < 
vNum
; idx++){

593 
»adBy‹s
 += 1;

594 if(
d•th
[
idx
] == -1){

595 
äÚt›r
.
	`push_back
(
idx
);

597 if(
d•th
[
idx
] =ğ
Ëv–
){

598 
deg»e
 = 
½ao
[
idx
+1] -„pao[idx];

599 if(
deg»e
 >ğ
ÿcheTh»shŞd
){

600 
pšgBufãr
.
	`push_back
(
idx
);

607 if(
tİDown
){

608 autØ
vidx
 : 
äÚt›r
){

609 
»adBy‹s
 += 4 * 2;

610 
»adBur¡s
 += 1;

611 
deg»e
 = 
½ao
[
vidx
+1] -„pao[vidx];

612 if(
deg»e
 >ğ
hubV”‹xTh»shŞd
){

613 
äÚt›rHubV”‹xNum
++;

615 if(
deg»e
 >ğ
ÿcheTh»shŞd
){

616 
pšgBufãr
.
	`push_back
(
vidx
);

619 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
½ao
[
vidx
+1] -„pao[vidx], 4);

620 
cidx
 = 
½ao
[
vidx
]; cidx <„pao[vidx+1]; cidx++){

622 
»adBy‹s
 += 4;

623 
outNgb
 = 
cŸo
[
cidx
];

625 if(
	`isInBufãr
(
pšgBufãr
, 
outNgb
)){

628 if(
d•th
[
outNgb
] == -1){

629 
»adBy‹s
 += 1;

630 
wr™eBy‹s
 += 1;

631 
»adBur¡s
 += 1;

632 
wr™eBur¡s
 += 1;

633 
d•th
[
outNgb
] = 
Ëv–
 + 1;

636 
»adBy‹s
 += 1;

637 
»adBur¡s
 += 1;

644 
vis™edNgbNum
 = 0;

645 autØ
vidx
 : 
äÚt›r
){

646 
»adBy‹s
 += 4 * 2;

647 
»adBur¡s
 += 1;

648 
deg»e
 = 
½ai
[
vidx
+1] -„pai[vidx];

650 
»adBur¡s
 +ğ
	`g‘Bur¡Num
(
½ai
[
vidx
+1] -„pai[vidx], 4);

651 
cidx
 = 
½ai
[
vidx
]; cidx <„pai[vidx+1]; cidx++){

652 
»adBy‹s
 += 4;

653 
šNgb
 = 
cŸi
[
cidx
];

655 if(
	`isInBufãr
(
pšgBufãr
, 
šNgb
)){

656 
wr™eBy‹s
 += 1;

657 
wr™eBur¡s
 += 1;

658 
d•th
[
vidx
] = 
Ëv–
 + 1;

659 if(
deg»e
 >ğ
hubV”‹xTh»shŞd
){

660 
äÚt›rHubV”‹xNum
++;

662 if(
deg»e
 >ğ
ÿcheTh»shŞd
){

663 
pÚgBufãr
.
	`push_back
(
vidx
);

665 
vis™edNgbNum
++;

668 if(
d•th
[
šNgb
] =ğ
Ëv–
){

669 
»adBy‹s
 += 1;

670 
wr™eBy‹s
 += 1;

671 
wr™eBur¡s
 += 1;

672 
»adBur¡s
 += 1;

673 
d•th
[
vidx
] = 
Ëv–
 + 1;

674 if(
deg»e
 >ğ
hubV”‹xTh»shŞd
){

675 
äÚt›rHubV”‹xNum
++;

677 if(
deg»e
 >ğ
ÿcheTh»shŞd
){

678 
pÚgBufãr
.
	`push_back
(
vidx
);

680 
vis™edNgbNum
++;

684 
»adBy‹s
 += 1;

685 
»adBur¡s
 += 1;

691 
äÚt›rDi¡
.
	`push_back
(
äÚt›r
.
	`size
());

694 
Ëv–
++;

695 
eofBfs
 = 
äÚt›r
.
	`em±y
(è|| (
tİDown
 =ğ
çl£
 && 
vis™edNgbNum
 == 0);

696 
hubP”ûÁage
 = 
äÚt›rHubV”‹xNum
 * 1.0 / 
tÙ®HubV”‹xNum
;

697 if(
tİDown
 && 
hubP”ûÁage
 >ğ
®pha
){

698 
tİDown
 = 
çl£
;

700 if(
tİDown
 =ğ
çl£
 && 
vis™edNgbNum
 <ğ
b‘a
){

701 
tİDown
 = 
Œue
;

702 
pšgBufãr
 = 
pÚgBufãr
;

703 
pÚgBufãr
.
	`ş—r
();

705 if(
tİDown
 =ğ
çl£
){

706 
pšgBufãr
 = 
pÚgBufãr
;

707 
pÚgBufãr
.
	`ş—r
();

711 } !
eofBfs
);

714 autØ
d
 : 
d•th
){

715 
fhªdË
 << 
d
 << " ";

717 
fhªdË
 << 
¡d
::
’dl
;

719 
¡d
::
cout
 << "»ad/wr™by‹s: " << 
»adBy‹s
 << " " << 
wr™eBy‹s
 << std::
’dl
;

720 
¡d
::
cout
 << "»ad/wr™bur¡s: " << 
»adBur¡s
 << " " << 
wr™eBur¡s
 << std::
’dl
;

722 
fhªdË
 << "äÚt›¸di¡ributiÚ: " << 
¡d
::
’dl
;

723 autØ
num
 : 
äÚt›rDi¡
){

724 
fhªdË
 << 
num
 << " ";

726 
fhªdË
 << 
¡d
::
’dl
;

728 
	}
}

731 
	gCSR
::
	$deg»eAÇlysis
(){

733 
¡d
::
m­
<, > 
šDegDi¡
;

734 
¡d
::
m­
<, > 
outDegDi¡
;

735 
idx
 = 0; idx < 
vNum
; idx++){

736 
outDeg»e
 = 
½ao
[
idx
+1] -„pao[idx];

737 
šDeg»e
 = 
½ai
[
idx
+1] -„pai[idx];

739 if(
šDegDi¡
.
	`fšd
(
šDeg»e
è=ğšDegDi¡.
	`’d
()){

740 
šDegDi¡
[
šDeg»e
] = 1;

743 
šDegDi¡
[
šDeg»e
]++;

746 if(
outDegDi¡
.
	`fšd
(
outDeg»e
è=ğoutDegDi¡.
	`’d
()){

747 
outDegDi¡
[
outDeg»e
] = 1;

750 
outDegDi¡
[
outDeg»e
]++;

754 
¡d
::
cout
 << "š deg»di¡ributiÚ: " << std::
’dl
;

755 autØ
™
 = 
šDegDi¡
.
	`begš
(); iˆ!ğšDegDi¡.
	`’d
(); it++){

756 
¡d
::
cout
 << 
™
->
fœ¡
 << " " << it->
£cÚd
 << std::
’dl
;

759 
¡d
::
cout
 << "ouˆdeg»di¡ributiÚ: " << std::
’dl
;

760 autØ
™
 = 
outDegDi¡
.
	`begš
(); iˆ!ğoutDegDi¡.
	`’d
(); it++){

761 
¡d
::
cout
 << 
™
->
fœ¡
 << " " << it->
£cÚd
 << std::
’dl
;

764 
	}
}

766 
	gCSR
::
	$g‘HubV”‹xNum
(){

767 
maxDeg
 = 0;

768 
hubV”‹xNum
 = 0;

769 
idx
 = 0; idx < 
vNum
; idx++){

770 
deg»e
 = 
½ao
[
idx
+1] -„pao[idx];

771 if(
deg»e
 >ğ
hubV”‹xTh»shŞd
){

772 
hubV”‹xNum
++;

774 if(
deg»e
 > 
maxDeg
) maxDeg = degree;

778 if(
hubV”‹xNum
 == 0)

779 
hubV”‹xNum
 = 1;

781  
hubV”‹xNum
;

782 
	}
}

784 
boŞ
 
	gCSR
::
isInBufãr
(

785 cÚ¡ 
¡d
::
veùÜ
<> &
bufãr
,

786 cÚ¡ &
idx
)

788 if(
	g¡d
::
fšd
(
bufãr
.
begš
(), bufãr.
’d
(), 
idx
) != buffer.end()){

789  
Œue
;

792  
	gçl£
;

796 
	gCSR
::
	$g‘Bur¡Num
(
num
, 
size
){

797 
Ëngth
 = 
num
 * 
size
;

798 if(
Ëngth
 % 
GL
::
bur¡Ën
 == 0){

799  
Ëngth
/
GL
::
bur¡Ën
;

802  (
Ëngth
/
GL
::
bur¡Ën
 + 1);

804 
	}
}

	@graph.h

1 #iâdeà
__GRAPH_H__


2 
	#__GRAPH_H__


	)

4 
	~<veùÜ
>

5 
	~<f¡»am
>

6 
	~<io¡»am
>

7 
	~<™”©Ü
>

8 
	~<c¡dlib
>

9 
	~<s¡»am
>

10 
	~<cm©h
>

11 
	~<m­
>

12 
	~<®gÜ™hm
>

14 
	#HERE
 dØ{
¡d
::
cout
 << "Fe: " << 
__FILE__
 << " Lše: " << 
__LINE__
 << std::
’dl
;} 0)

	)

16 şas 
	cGL
{

17 
	mpublic
:

18 
bur¡Ën
;

21 şas 
	cV”‹x
 {

22 
	mpublic
:

23 
idx
;

24 
	mšDeg
;

25 
	moutDeg
;

27 
	m¡d
::
veùÜ
<> 
šVid
;

28 
	m¡d
::
veùÜ
<> 
outVid
;

30 
ex¶ic™
 
	$V”‹x
(
_idx
) {

31 
idx
 = 
_idx
;

34 ~
	$V”‹x
(){

36 
	}
}

40 şas 
	cG¿ph
{

41 
	mpublic
:

42 
v”‹xNum
;

43 
	medgeNum
;

44 
	m¡d
::
veùÜ
<
V”‹x
*> 
v”tiûs
;

46 
G¿ph
(cÚ¡ 
¡d
::
¡ršg
 &
âame
);

47 ~
G¿ph
();

48 
g‘RªdomS¹Indiûs
(
¡d
::
veùÜ
<> &
¡¬tIndiûs
);

49 
g‘St
();

51 
	m´iv©e
:

52 
boŞ
 
isUg¿ph
;

53 
g‘MaxIdx
(cÚ¡ 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a
);

54 
g‘MšIdx
(cÚ¡ 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a
);

55 
lßdFe
(

56 cÚ¡ 
¡d
::
¡ršg
& 
âame
,

57 
¡d
::
veùÜ
<¡d::veùÜ<>> &
d©a


63 şas 
	cCSR
{

64 
	mpublic
:

65 
¡d
::
veùÜ
<> 
weight
;

66 
	m¡d
::
veùÜ
<> 
½ao
;

67 
	m¡d
::
veùÜ
<> 
cŸo
;

68 
	m¡d
::
veùÜ
<> 
½ai
;

69 
	m¡d
::
veùÜ
<> 
cŸi
;

72 
ex¶ic™
 
CSR
(cÚ¡ 
G¿ph
 &
g
);

74 
£tBfsP¬am
(

75 
_®pha
,

76 
_b‘a
,

77 
_hubV”‹xTh»shŞd
,

78 
_ÿcheTh»shŞd
,

79 
_buck‘Num
);

82 
boŞ
 
ÿcheHybridBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
);

85 
boŞ
 
hybridBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
);

88 
boŞ
 
basicBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
);

91 
boŞ
 
tdBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
);

94 
boŞ
 
buBfs
(cÚ¡ &
¡¬tIdx
, 
¡d
::
of¡»am
 &
fhªdË
);

96 
deg»eAÇlysis
();

97 ~
CSR
();

99 
	m´iv©e
:

100 cÚ¡ 
vNum
;

101 cÚ¡ 
	meNum
;

102 
	m®pha
;

103 
	mb‘a
;

104 
	mhubV”‹xTh»shŞd
;

105 
	mÿcheTh»shŞd
;

106 
	mbuck‘Num
;

108 
boŞ
 
isInBufãr
(

109 cÚ¡ 
¡d
::
veùÜ
<> &
bufãr
,

110 cÚ¡ &
idx
);

111 
g‘HubV”‹xNum
();

112 
g‘Bur¡Num
(
num
, 
size
);

	@
1
.
1
/usr/include
3
26
bfs.cpp
graph.cpp
graph.h
